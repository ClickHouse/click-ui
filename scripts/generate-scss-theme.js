/**
 * Generate filtered CSS theme containing only variables for SCSS-migrated components
 *
 * This script:
 * 1. Reads the full cui-default-theme.css
 * 2. Filters to only include variables for components migrated to SCSS
 * 3. Outputs a minimal CSS file
 *
 * As components are migrated, add their names to MIGRATED_COMPONENTS array
 */

import { readFileSync, writeFileSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Components that have been migrated to SCSS modules
const MIGRATED_COMPONENTS = [
  'separator',
  'spacer',
  // Add more component names here as they are migrated
  // Example: 'button', 'card', 'input', etc.
];

// Read the full CSS file
const cssPath = join(__dirname, '../src/styles/cui-default-theme.css');
const fullCSS = readFileSync(cssPath, 'utf-8');

// Parse the CSS file
const lines = fullCSS.split('\n');
const filteredLines = [];
let inRootBlock = false;
let foundVariables = false;

for (let i = 0; i < lines.length; i++) {
  const line = lines[i];

  // Keep the opening comments and :root declaration
  if (line.includes('/**') || line.includes('*/') || line.trim() === '' || line.includes(':root')) {
    filteredLines.push(line);
    if (line.includes(':root')) {
      inRootBlock = true;
    }
    continue;
  }

  if (inRootBlock) {
    // Check if this line contains a CSS variable for a migrated component
    const isRelevantVariable = MIGRATED_COMPONENTS.some(component => {
      const pattern = `--click-${component}`;
      return line.includes(pattern);
    });

    if (isRelevantVariable) {
      filteredLines.push(line);
      foundVariables = true;
    }

    // Keep the closing brace
    if (line.trim() === '}') {
      filteredLines.push(line);
      inRootBlock = false;
    }
  }
}

// Generate the filtered CSS
const outputPath = join(__dirname, '../src/styles/cui-scss-theme.css');
const header = `/**
 * Click UI - SCSS Theme Variables (Filtered)
 *
 * This file contains CSS variables ONLY for components migrated to SCSS.
 * Generated by scripts/generate-scss-theme.js
 *
 * Migrated components: ${MIGRATED_COMPONENTS.join(', ')}
 *
 * DO NOT EDIT MANUALLY - Run: node scripts/generate-scss-theme.js
 */

`;

const output = header + filteredLines.join('\n');
writeFileSync(outputPath, output);

// Count variables
const variableCount = filteredLines.filter(line => line.includes('--click-')).length;

console.log('‚úÖ Generated filtered SCSS theme CSS');
console.log(`üì¶ Migrated components: ${MIGRATED_COMPONENTS.join(', ')}`);
console.log(`üéØ Variables included: ${variableCount}`);
console.log(`üìÅ Output: ${outputPath}`);

if (!foundVariables) {
  console.warn('‚ö†Ô∏è  Warning: No variables found for migrated components');
}
